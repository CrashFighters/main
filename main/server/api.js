const api=require("../setup/preload/api.js").execute(),settings=require("../../settings.json"),isModuleInstalled=require("../functions/isModuleInstalled.js").execute,statusCode=require("../functions/error/statusCode.js").execute,parseErrorOnline=require("../functions/error/parseErrorOnline.js").execute;module.exports={execute(e,r,t){let n=require("../functions/get/messages").execute({request:e}).mainFunction(),s=(e,t)=>parseErrorOnline(e,r,t),{path:o,params:a}=require("../functions/parse/apiCall.js").execute(e.url);if(!api[o])return statusCode(r,404,{text:n.error.apiCallNotFound});if(!api[o].enabled.dependencies.installed){if(isModuleInstalled("text")){let e=require(`../../${settings.generic.path.files.modules}text/createList.js`).createList(api[o].enabled.dependencies.dependenciesNotInstalled);return s(new Error(n.error.moduleNotInstalledForShort.replace("{api}",o)),n.error.modulesNotInstalledFor.replace("{api}",o).replace("{dependencie}",e))}return s(new Error(n.error.moduleNotInstalledForShort.replace("{api}",o)),n.error.moduleNotInstalledFor.replace("{api}",o).replace("{dependencie}",api[o].enabled.dependencies.dependenciesNotInstalled[0]))}{let l=api[o].file,d=!0;try{l.execute||(d=!1)}catch{d=!1}if(!d)return s(new Error(n.error.executeFunctionNotFoundWithFile.replace("{file}",o)),n.error.executeFunctionNotFound);if("POST"==e.method){let n="";e.on("data",(function(e){n+=e})),e.on("end",(async function(){let o={};n.split("&").forEach(((e,r)=>{let t=decodeURIComponent(e.split("=")[0].replace(/\+/g," ")),n=decodeURIComponent(e.split("=")[1].replace(/\+/g," "));o[t]=decodeURIComponent(n)})),a=o,l.execute({statusCode:(e,t)=>{statusCode(r,e,{text:t})},parseError:s,end:e=>{r.end(e)},request:e,isModuleInstalled:isModuleInstalled,params:a,response:r,middleWareData:t})}))}else l.execute({statusCode:(e,t)=>{statusCode(r,e,{text:t})},parseError:s,end:e=>{r.end(e)},request:e,isModuleInstalled:isModuleInstalled,params:a,response:r,middleWareData:t})}}};
