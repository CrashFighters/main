const api=require("../setup/preload/api.js").execute(),settings=require("../../settings.json"),isModuleInstalled=require("../functions/isModuleInstalled.js").execute,parseErrorOnline=require("../functions/error/parseErrorOnline.js").execute,statusCode=(e,t,{text:r,short:s})=>{e.end(JSON.stringify({error:!0,code:t,text:r,short:s}))};module.exports={execute(e,t,r){let s=require("../functions/get/messages").execute({request:e}).mainFunction(),n=(e,r)=>parseErrorOnline(e,t,r),{path:o,params:l}=require("../functions/parse/apiCall.js").execute(e.url);if(!api[o])return statusCode(t,404,{text:s.error.apiCallNotFound});if(!api[o].enabled.dependencies.installed){if(isModuleInstalled("text")){let e=require(`../../${settings.generic.path.files.modules}text/createList.js`).createList(api[o].enabled.dependencies.dependenciesNotInstalled);return n(new Error(s.error.moduleNotInstalledForShort.replace("{api}",o)),s.error.modulesNotInstalledFor.replace("{api}",o).replace("{dependencie}",e))}return n(new Error(s.error.moduleNotInstalledForShort.replace("{api}",o)),s.error.moduleNotInstalledFor.replace("{api}",o).replace("{dependencie}",api[o].enabled.dependencies.dependenciesNotInstalled[0]))}{let a=api[o].file,d=!0;try{a.execute||(d=!1)}catch{d=!1}if(!d)return n(new Error(s.error.executeFunctionNotFoundWithFile.replace("{file}",o)),s.error.executeFunctionNotFound);if("POST"==e.method){let s="";e.on("data",(function(e){s+=e})),e.on("end",(async function(){let o={};s.split("&").forEach(((e,t)=>{let r=decodeURIComponent(e.split("=")[0].replace(/\+/g," ")),s=decodeURIComponent(e.split("=")[1].replace(/\+/g," "));o[r]=decodeURIComponent(s)})),l=o,a.execute({statusCode:(e,r,s)=>{statusCode(t,e,{text:s,short:r})},parseError:n,end:e=>{t.end(e)},request:e,isModuleInstalled:isModuleInstalled,params:l,response:t,middleWareData:r})}))}else a.execute({statusCode:(e,r,s)=>{statusCode(t,e,{text:s,short:r})},parseError:n,end:e=>{t.end(e)},request:e,isModuleInstalled:isModuleInstalled,params:l,response:t,middleWareData:r})}}};
