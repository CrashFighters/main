const{get:get,set:set}=require("../../database/functions/database.js"),perspective=require("./perspective.js"),fs=require("fs"),path=require("path");async function execute(){const e=JSON.parse(fs.readFileSync(path.resolve(__dirname,"../data/queue.json")).toString());if(0===e.length)return setTimeout(execute,0);const{community:t,post:s}=e[0];console.log("Processing",t,s);const i=await get(),a=i.communities?.[t]?.posts?.[s];if(a){const e=await perspective(a.message);a.perspective=e,await set(i)}const n=e.slice(1);fs.writeFileSync(path.resolve(__dirname,"../data/queue.json"),JSON.stringify(n)),setTimeout(execute,1500)}fs.existsSync(path.resolve(__dirname,"../data/queue.json"))||fs.writeFileSync(path.resolve(__dirname,"../data/queue.json"),JSON.stringify([])),module.exports=async()=>{setTimeout(execute,1500)};
